#include "include1/ssd1306.h"
#include <string.h> // Para memset
#include <stdlib.h> // Para abs

// Definições do display
#define SSD1306_WIDTH       128
#define SSD1306_HEIGHT      64
#define SSD1306_I2C_ADDR    0x3C

// Cores para desenhar
typedef enum {
    BLACK = 0,
    WHITE = 1
} SSD1306_COLOR;

// Definições internas do driver
#define SSD1306_BUFFER_SIZE (SSD1306_WIDTH * (SSD1306_HEIGHT / 8))

// Comandos do SSD1306 (Controladores OLED baseados no SSD1306)

// Configuração de Endereçamento da GDDRAM (Graphic Display Data RAM)
#define SSD1306_SET_MEMORY_MODE             0x20 // Comando: Define o modo de endereçamento da memória.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   0x00: Modo de Endereçamento Horizontal (endereçamento avança na coluna, depois na página)
                                                 //   0x01: Modo de Endereçamento Vertical (endereçamento avança na página, depois na coluna)
                                                 //   0x02: Modo de Endereçamento por Página (Padrão e mais comum; endereçamento avança na coluna dentro de uma página, depois para a próxima página)

#define SSD1306_SET_COLUMN_ADDRESS          0x21 // Comando: Define os endereços de coluna inicial e final para o acesso à GDDRAM.
                                                 // Parâmetros esperados (2 bytes APÓS este comando):
                                                 //   Byte 1: Endereço da Coluna Inicial (0-127 para display de 128 colunas)
                                                 //   Byte 2: Endereço da Coluna Final (0-127, deve ser >= Coluna Inicial)

#define SSD1306_SET_PAGE_ADDRESS            0x22 // Comando: Define os endereços de página inicial e final para o acesso à GDDRAM.
                                                 // Parâmetros esperados (2 bytes APÓS este comando):
                                                 //   Byte 1: Endereço da Página Inicial (0-7 para 64 pixels de altura)
                                                 //   Byte 2: Endereço da Página Final (0-7, deve ser >= Página Inicial)

// Configurações de Hardware e Exibição
#define SSD1306_SET_DISPLAY_START_LINE      0x40 // Comando: Define a linha de início do display GDDRAM (remapeamento vertical).
                                                 // Este comando é um conjunto de comandos.
                                                 // Opções: O valor `0x40` é a base, e os bits 0-5 do *próprio byte do comando*
                                                 //         são usados para definir a linha (0-63).
                                                 // Exemplo: 0x40 para linha 0, 0x41 para linha 1, ..., 0x7F para linha 63.

#define SSD1306_SET_CONTRAST                0x81 // Comando: Define o nível de contraste do display.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Byte 1: Nível de Contraste (0x00 - 0xFF, 0x00=Mínimo Brilho, 0xFF=Máximo Brilho)

#define SSD1306_SET_CHARGE_PUMP             0x8D // Comando: Ativa/Desativa o Charge Pump (circuito interno essencial para o OLED).
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   0x10: Desativar o Charge Pump.
                                                 //   0x14: Ativar o Charge Pump (necessário para o display funcionar).

#define SSD1306_SET_SEGMENT_REMAP           0xA0 // Comando: Remapeia o endereçamento das colunas dos Segmentos (SEG0 para SEG127).
                                                 // Este comando é um conjunto de comandos.
                                                 // Opções: O bit 0 do *próprio byte do comando* é usado para o remapeamento.
                                                 //   0xA0: Remapeamento normal (Coluna 0 -> SEG0, Coluna 127 -> SEG127).
                                                 //   0xA1: Remapeamento invertido (Coluna 127 -> SEG0, Coluna 0 -> SEG127).
                                                 //         Útil para corrigir a orientação horizontal (espelhamento).

#define SSD1306_SET_ENTIRE_ON               0xA4 // Comando: Habilita o display para seguir o conteúdo da GDDRAM (normal) ou acender todos os pixels.
                                                 // Este comando é um conjunto de comandos.
                                                 // Opções: O bit 0 do *próprio byte do comando* altera o modo.
                                                 //   0xA4: Display normal, segue o conteúdo da GDDRAM (reset default).
                                                 //   0xA5: Acende todos os pixels (ignora o conteúdo da GDDRAM).

#define SSD1306_SET_NORMAL_DISPLAY          0xA6 // Comando: Define a exibição normal (pixels 1/ON = WHITE, pixels 0/OFF = BLACK).
#define SSD1306_SET_INVERSE_DISPLAY         0xA7 // Comando: Define a exibição invertida (pixels 1/ON = BLACK, pixels 0/OFF = WHITE).

#define SSD1306_SET_MUX_RATIO               0xA8 // Comando: Define a taxa de multiplexação (altura de linha ativa do display).
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Byte 1: Taxa de Multiplexação (N = 0x0F a 0x3F). O valor real é (N+1).
                                                 //           Para um display de 64 pixels de altura, geralmente é 0x3F (63+1=64).

#define SSD1306_SET_DISPLAY                 0xAE // Comando: Ativa ou desativa o display OLED.
                                                 // Este comando é um conjunto de comandos.
                                                 // Opções: O bit 0 do *próprio byte do comando* ativa/desativa.
                                                 //   0xAE: Display OFF (modo de suspensão).
                                                 //   0xAF: Display ON.

#define SSD1306_SET_COM_OUTPUT_DIRECTION    0xC0 // Comando: Define a direção do mapeamento das saídas COM (linhas do display).
                                                 // Este comando é um conjunto de comandos.
                                                 // Opções: O bit 3 do *próprio byte do comando* altera a direção.
                                                 //   0xC0: Mapeamento normal (COM0 -> COM0, COM63 -> COM63).
                                                 //   0xC8: Mapeamento invertido (COM63 -> COM0, COM0 -> COM63).
                                                 //         Útil para corrigir a orientação vertical (virar o display de cabeça para baixo).

#define SSD1306_SET_DISPLAY_OFFSET          0xD3 // Comando: Define o deslocamento vertical da GDDRAM para o display.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Byte 1: Deslocamento vertical (0-63 para 64 pixels).

#define SSD1306_SET_DISPLAY_CLOCK_DIVIDE    0xD5 // Comando: Define a frequência de clock do oscilador interno e a taxa de divisão.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Bits 3:0 (DSET): Divisor de clock (0x00-0x0F).
                                                 //   Bits 7:4 (ASET): Frequência do oscilador (0x00-0x0F).
                                                 //   Valor padrão típico: 0x80 (Divisor=1, Frequência=8).

#define SSD1306_SET_PRECHARGE               0xD9 // Comando: Define o período de pré-carga.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Bits 3:0: Duração da Fase 1 (1-15 clocks).
                                                 //   Bits 7:4: Duração da Fase 2 (1-15 clocks).
                                                 //   Valor padrão típico: 0xF1 (Fase 1=1, Fase 2=15 para VCC interno).
                                                 //   Outro valor comum: 0x22 (Fase 1=2, Fase 2=2 para VCC externo).

#define SSD1306_SET_COM_PIN_CONFIG          0xDA // Comando: Define a configuração dos pinos COM (sequência e desativação).
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   Bit 4: Habilita/Desabilita COM desabilitar (0=sequencial, 1=alternado).
                                                 //   Bit 5: Habilita/Desabilita COM left/right remap.
                                                 //   Valor padrão típico para 128x64: 0x12 (alternado, sem remapeamento).

#define SSD1306_SET_VCOMH_DESELECT_LEVEL    0xDB // Comando: Define o nível de deseleção VCOMH.
                                                 // Parâmetro esperado (1 byte APÓS este comando):
                                                 //   0x00: 0.65 x VCC
                                                 //   0x20: 0.77 x VCC (Valor padrão típico).
                                                 //   0x30: 0.83 x VCC

// Comandos de Rolagem (Scrolling)
#define SSD1306_DEACTIVATE_SCROLL           0x2E // Comando: Desativa o movimento de rolagem horizontal ou vertical configurado.
#define SSD1306_ACTIVATE_SCROLL             0x2F // Comando: Ativa o movimento de rolagem horizontal ou vertical configurado.

// Framebuffer global
static uint8_t ssd1306_framebuffer[SSD1306_BUFFER_SIZE];

// Pinos I2C
#define I2C_SDA_PIN 14
#define I2C_SCL_PIN 15

// Fonte 8x8 - Cada byte representa uma coluna vertical de 8 pixels.
// Bit 0 é o pixel superior, Bit 7 é o pixel inferior.
// Expandido para 256 caracteres (ASCII e Latin-1)
static const uint8_t font8x8_basic[256][8] = {
    // 0x00 - 0x1F (Caracteres de Controle - Não imprimíveis, mapeados para espaço)
    [0x00] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // NUL
    [0x01] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SOH
    [0x02] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // STX
    [0x03] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ETX
    [0x04] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // EOT
    [0x05] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ENQ
    [0x06] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ACK
    [0x07] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // BEL
    [0x08] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // BS
    [0x09] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // HT
    [0x0A] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // LF
    [0x0B] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // VT
    [0x0C] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // FF
    [0x0D] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // CR
    [0x0E] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SO
    [0x0F] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SI
    [0x10] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DLE
    [0x11] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DC1
    [0x12] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DC2
    [0x13] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DC3
    [0x14] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DC4
    [0x15] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // NAK
    [0x16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SYN
    [0x17] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ETB
    [0x18] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // CAN
    [0x19] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // EM
    [0x1A] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SUB
    [0x1B] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ESC
    [0x1C] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // FS
    [0x1D] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // GS
    [0x1E] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // RS
    [0x1F] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // US

    // 0x20 - 0x7F (Caracteres Imprimíveis ASCII)
    [' '] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Espaço (ASCII 32)
    ['!'] = {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00},
    ['"'] = {0x6C,0x6C,0x48,0x00,0x00,0x00,0x00,0x00},
    ['#'] = {0x6C,0x6C,0xFE,0x6C,0xFE,0x6C,0x6C,0x00},
    ['$'] = {0x10,0x7E,0x90,0x7C,0x12,0xFC,0x10,0x00},
    ['%'] = {0xC2,0xC6,0x0C,0x18,0x30,0x66,0xC6,0x00},
    ['&'] = {0x38,0x6C,0x38,0x76,0xDC,0xCC,0x76,0x00},
    ['\''] = {0x30,0x30,0x60,0x00,0x00,0x00,0x00,0x00},
    ['('] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00},
    [')'] = {0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00},
    ['*'] = {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00},
    ['+'] = {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00},
    [','] = {0x00,0x00,0x00,0x00,0x18,0x18,0x30,0x00},
    ['-'] = {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00},
    ['.'] = {0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00},
    ['/'] = {0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00},
    ['0'] = {0x3C,0x66,0xCE,0xD6,0xE6,0x66,0x3C,0x00},
    ['1'] = {0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00},
    ['2'] = {0x3C,0x66,0x06,0x0C,0x18,0x30,0x7E,0x00},
    ['3'] = {0x3C,0x66,0x06,0x1C,0x06,0x66,0x3C,0x00},
    ['4'] = {0x0C,0x1C,0x3C,0x6C,0xFE,0x0C,0x0C,0x00},
    ['5'] = {0x7E,0x60,0x7C,0x06,0x06,0x66,0x3C,0x00},
    ['6'] = {0x3C,0x66,0x60,0x7C,0x66,0x66,0x3C,0x00},
    ['7'] = {0x7E,0x06,0x0C,0x18,0x30,0x30,0x30,0x00},
    ['8'] = {0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00},
    ['9'] = {0x3C,0x66,0x66,0x3E,0x06,0x66,0x3C,0x00},
    [':'] = {0x00,0x00,0x18,0x18,0x00,0x18,0x18,0x00},
    [';'] = {0x00,0x00,0x18,0x18,0x00,0x18,0x30,0x00},
    ['<'] = {0x18,0x30,0x60,0xC0,0x60,0x30,0x18,0x00},
    ['='] = {0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00},
    ['>'] = {0x60,0x30,0x18,0x0C,0x18,0x30,0x60,0x00},
    ['?'] = {0x3C,0x66,0x0C,0x18,0x30,0x00,0x18,0x00},
    ['@'] = {0x3C,0x66,0x7E,0x7E,0x7E,0x42,0x3C,0x00},
    ['A'] = {0x18,0x3C,0x66,0x66,0x7E,0x66,0x66,0x00},
    ['B'] = {0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00},
    ['C'] = {0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00},
    ['D'] = {0x78,0x6C,0x66,0x66,0x66,0x6C,0x78,0x00},
    ['E'] = {0x7E,0x60,0x60,0x7C,0x60,0x60,0x7E,0x00},
    ['F'] = {0x7F,0x40,0x40,0x7C,0x40,0x40,0x40,0x00},
    ['G'] = {0x3C,0x66,0x60,0x6E,0x66,0x66,0x3C,0x00},
    ['H'] = {0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00},
    ['I'] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00},
    ['J'] = {0x0E,0x06,0x06,0x06,0x66,0x66,0x3C,0x00},
    ['K'] = {0x66,0x6C,0x78,0x70,0x78,0x6C,0x66,0x00},
    ['L'] = {0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00},
    ['M'] = {0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x00},
    ['N'] = {0x66,0x76,0x7E,0x7E,0x6E,0x66,0x66,0x00},
    ['O'] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00},
    ['P'] = {0x7C,0x66,0x66,0x7C,0x60,0x60,0x60,0x00},
    ['Q'] = {0x3C,0x66,0x66,0x66,0x6E,0x3C,0x0E,0x00},
    ['R'] = {0x7C,0x66,0x66,0x7C,0x6C,0x66,0x66,0x00},
    ['S'] = {0x3C,0x66,0x60,0x3C,0x06,0x66,0x3C,0x00},
    ['T'] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x00},
    ['U'] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00},
    ['V'] = {0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00},
    ['W'] = {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00},
    ['X'] = {0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00},
    ['Y'] = {0x66,0x66,0x66,0x3C,0x18,0x18,0x18,0x00},
    ['Z'] = {0x7E,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00},
    ['['] = {0x7E,0x60,0x60,0x60,0x60,0x60,0x7E,0x00},
    ['\\'] = {0xC0,0x60,0x30,0x18,0x0C,0x06,0x03,0x00},
    [']'] = {0x7E,0x06,0x06,0x06,0x06,0x06,0x7E,0x00},
    ['^'] = {0x00,0x30,0x6C,0xC6,0x00,0x00,0x00,0x00},
    ['_'] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE},
    ['`'] = {0x00,0x60,0x30,0x00,0x00,0x00,0x00,0x00},
    ['a'] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00},
    ['b'] = {0x7F,0x60,0x60,0x7C,0x66,0x66,0x3C,0x00},
    ['c'] = {0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00},
    ['d'] = {0x3C,0x66,0x66,0x7C,0x60,0x60,0x7F,0x00},
    ['e'] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00},
    ['f'] = {0x1C,0x30,0x30,0x7E,0x30,0x30,0x30,0x00},
    ['g'] = {0x00,0x00,0x3C,0x66,0x66,0x3E,0x06,0x7C},
    ['h'] = {0x7F,0x06,0x06,0x3E,0x66,0x66,0x66,0x00},
    ['i'] = {0x18,0x00,0x38,0x10,0x10,0x10,0x3C,0x00},
    ['j'] = {0x18,0x00,0x30,0x00,0x30,0x30,0x30,0x60},
    ['k'] = {0x7F,0x06,0x0C,0x18,0x30,0x60,0x66,0x00},
    ['l'] = {0x38,0x10,0x10,0x10,0x10,0x10,0x7C,0x00},
    ['m'] = {0x00,0x00,0x3E,0x68,0x68,0x68,0x6C,0x00},
    ['n'] = {0x00,0x00,0x3E,0x66,0x66,0x66,0x66,0x00},
    ['o'] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00},
    ['p'] = {0x00,0x7C,0x66,0x66,0x7C,0x60,0x60,0x00},
    ['q'] = {0x00,0x3C,0x66,0x66,0x7C,0x06,0x06,0x00},
    ['r'] = {0x00,0x00,0x3E,0x0C,0x06,0x06,0x00,0x00},
    ['s'] = {0x00,0x00,0x3C,0x60,0x3C,0x06,0x7C,0x00},
    ['t'] = {0x20,0x7C,0x20,0x20,0x20,0x26,0x1C,0x00},
    ['u'] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00},
    ['v'] = {0x00,0x00,0x66,0x66,0x66,0x3C,0x18,0x00},
    ['w'] = {0x00,0x00,0x63,0x6B,0x7F,0x77,0x63,0x00},
    ['x'] = {0x00,0x00,0x66,0x3C,0x18,0x3C,0x66,0x00},
    ['y'] = {0x00,0x00,0x66,0x66,0x3E,0x06,0x06,0x7C},
    ['z'] = {0x00,0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00},
    ['{'] = {0x0C,0x18,0x18,0x60,0x18,0x18,0x0C,0x00},
    ['|'] = {0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00},
    ['}'] = {0x60,0x30,0x30,0x0C,0x30,0x30,0x60,0x00},
    ['~'] = {0x00,0x30,0x0C,0x18,0x00,0x00,0x00,0x00},
    [0x7F] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // DEL (Non-printable)

    // 0x80 - 0x9F (ISO-8859-1 Control/Unused, ou Windows-1252)
    // Alguns desses são caracteres de controle no ISO-8859-1, mas no Windows-1252
    // são caracteres imprimíveis. Priorizamos a compatibilidade com Windows-1252 para o Euro.
    [0x80] = {0x00,0x30,0x48,0x48,0x7E,0x48,0x48,0x00}, // € Euro (Windows-1252)
    [0x81] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado
    [0x82] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ‚ no Win-1252)
    [0x83] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ƒ no Win-1252)
    [0x84] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou „ no Win-1252)
    [0x85] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou … no Win-1252)
    [0x86] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou † no Win-1252)
    [0x87] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ‡ no Win-1252)
    [0x88] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ˆ no Win-1252)
    [0x89] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ‰ no Win-1252)
    [0x8A] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou Š no Win-1252)
    [0x8B] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ‹ no Win-1252)
    [0x8C] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou Œ no Win-1252)
    [0x8D] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado
    [0x8E] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou Ž no Win-1252)
    [0x8F] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado
    [0x90] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado
    [0x91] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ‘ no Win-1252)
    [0x92] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ’ no Win-1252)
    [0x93] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou “ no Win-1252)
    [0x94] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ” no Win-1252)
    [0x95] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou • no Win-1252)
    [0x96] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou – no Win-1252, travessão)
    [0x97] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou — no Win-1252, em dash)
    [0x98] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ˜ no Win-1252)
    [0x99] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ™ no Win-1252)
    [0x9A] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou š no Win-1252)
    [0x9B] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou › no Win-1252)
    [0x9C] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou œ no Win-1252)
    [0x9D] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado
    [0x9E] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou ž no Win-1252)
    [0x9F] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // Não usado (ou Ÿ no Win-1252)

    // 0xA0 - 0xFF (ISO-8859-1 Latin-1 Supplement)
    [0xA0] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // NO-BREAK SPACE
    [0xA1] = {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, // ¡ INVERTED EXCLAMATION MARK (igual a '!')
    [0xA2] = {0x30,0x78,0x0C,0x18,0x30,0x60,0xC0,0x00}, // ¢ CENT SIGN
    [0xA3] = {0x10,0x7E,0x10,0x10,0x10,0x7E,0x10,0x00}, // £ POUND SIGN (igual a '$' virado)
    [0xA4] = {0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00}, // ¤ CURRENCY SIGN
    [0xA5] = {0x00,0x00,0x66,0x3C,0x66,0x00,0x00,0x00}, // ¥ YEN SIGN
    [0xA6] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ¦ BROKEN BAR (Mapeado para espaço)
    [0xA7] = {0x0C,0x18,0x18,0x00,0x18,0x18,0x0C,0x00}, // § SECTION SIGN
    [0xA8] = {0x00,0x00,0x30,0x60,0x00,0x00,0x00,0x00}, // ¨ DIAERESIS
    [0xA9] = {0x3C,0x66,0x42,0x42,0x42,0x66,0x3C,0x00}, // © COPYRIGHT SIGN
    [0xAA] = {0x00,0x00,0x18,0x0C,0x18,0x30,0x00,0x00}, // ª FEMININE ORDINAL INDICATOR
    [0xAB] = {0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00}, // « LEFT-POINTING DOUBLE ANGLE QUOTATION MARK
    [0xAC] = {0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00}, // ¬ NOT SIGN (Mapeado para espaço)
    [0xAD] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // SOFT HYPHEN (Mapeado para espaço)
    [0xAE] = {0x00,0x3C,0x66,0x66,0x66,0x3C,0x00,0x00}, // ® REGISTERED SIGN
    [0xAF] = {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00}, // ¯ MACRON (Mapeado para '-')
    [0xB0] = {0x0C,0x18,0x18,0x00,0x00,0x00,0x00,0x00}, // ° DEGREE SIGN
    [0xB1] = {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00}, // ± PLUS-MINUS SIGN
    [0xB2] = {0x00,0x00,0x18,0x0C,0x00,0x00,0x00,0x00}, // ² SUPERSCRIPT TWO
    [0xB3] = {0x00,0x00,0x0C,0x06,0x00,0x00,0x00,0x00}, // ³ SUPERSCRIPT THREE
    [0xB4] = {0x00,0x00,0x60,0x30,0x00,0x00,0x00,0x00}, // ´ ACUTE ACCENT
    [0xB5] = {0x00,0x00,0x66,0x66,0x66,0x3C,0x00,0x00}, // µ MICRO SIGN (similar a u)
    [0xB6] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ¶ PILCROW SIGN (Mapeado para espaço)
    [0xB7] = {0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00}, // · MIDDLE DOT
    [0xB8] = {0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00}, // ¸ CEDILLA
    [0xB9] = {0x00,0x00,0x06,0x0C,0x00,0x00,0x00,0x00}, // ¹ SUPERSCRIPT ONE
    [0xBA] = {0x00,0x00,0x3C,0x66,0x3C,0x00,0x00,0x00}, // º MASCULINE ORDINAL INDICATOR
    [0xBB] = {0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00}, // » RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK
    [0xBC] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00}, // ¼ VULGAR FRACTION ONE QUARTER
    [0xBD] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00}, // ½ VULGAR FRACTION ONE HALF
    [0xBE] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00}, // ¾ VULGAR FRACTION THREE QUARTERS
    [0xBF] = {0x18,0x18,0x00,0x18,0x30,0x18,0x7E,0x00}, // ¿ INVERTED QUESTION MARK

    // Caracteres Acentuados (Latin-1/ISO-8859-1) - Maiúsculas
    [0xC0] = {0x18,0x24,0x42,0x7E,0x42,0x42,0x42,0x00}, // À A grave
    [0xC1] = {0x0C,0x18,0x24,0x42,0x7E,0x42,0x42,0x00}, // Á A acute
    [0xC2] = {0x18,0x3C,0x42,0x7E,0x42,0x42,0x42,0x00}, // Â A circumflex
    [0xC3] = {0x0C,0x18,0x24,0x42,0x7E,0x42,0x42,0x00}, // Ã A tilde (similar a Á por simplicidade)
    [0xC4] = {0x18,0x3C,0x42,0x7E,0x42,0x42,0x42,0x00}, // Ä A diaeresis (similar a Â por simplicidade)
    [0xC5] = {0x18,0x3C,0x42,0x7E,0x42,0x42,0x42,0x00}, // Å A ring (similar a Â por simplicidade)
    [0xC6] = {0x3C,0x66,0x66,0x7E,0x66,0x66,0x3C,0x00}, // Æ AE
    [0xC7] = {0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00}, // Ç C cedilla (igual a C)
    [0xC8] = {0x3C,0x60,0x60,0x7C,0x60,0x60,0x7E,0x00}, // È E grave (similar a E)
    [0xC9] = {0x18,0x30,0x60,0x7C,0x60,0x60,0x7E,0x00}, // É E acute (similar a E)
    [0xCA] = {0x3C,0x66,0x60,0x7C,0x60,0x60,0x7E,0x00}, // Ê E circumflex (similar a E)
    [0xCB] = {0x3C,0x66,0x60,0x7C,0x60,0x60,0x7E,0x00}, // Ë E diaeresis (similar a E)
    [0xCC] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00}, // Ì I grave (similar a I)
    [0xCD] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00}, // Í I acute (similar a I)
    [0xCE] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00}, // Î I circumflex (similar a I)
    [0xCF] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00}, // Ï I diaeresis (similar a I)
    [0xD0] = {0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00}, // Ð ETH (similar a B)
    [0xD1] = {0x6E,0x7E,0x7E,0x66,0x66,0x66,0x66,0x00}, // Ñ N tilde (similar a N)
    [0xD2] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ò O grave (similar a O)
    [0xD3] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ó O acute (similar a O)
    [0xD4] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ô O circumflex (similar a O)
    [0xD5] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Õ O tilde (similar a O)
    [0xD6] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ö O diaeresis (similar a O)
    [0xD7] = {0x00,0x00,0x18,0x7E,0x18,0x00,0x00,0x00}, // × MULTIPLICATION SIGN
    [0xD8] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ø O stroke (similar a O)
    [0xD9] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ù U grave (similar a U)
    [0xDA] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ú U acute (similar a U)
    [0xDB] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Û U circumflex (similar a U)
    [0xDC] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}, // Ü U diaeresis (similar a U)
    [0xDD] = {0x66,0x66,0x66,0x3C,0x18,0x18,0x18,0x00}, // Ý Y acute (similar a Y)
    [0xDE] = {0x18,0x18,0x7E,0x18,0x18,0x00,0x18,0x00}, // Þ THORN (similar a !)
    [0xDF] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ß SHARP S (Mapeado para espaço)

    // Caracteres Acentuados (Latin-1/ISO-8859-1) - Minúsculas
    [0xE0] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // à a grave (similar a a)
    [0xE1] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // á a acute (similar a a)
    [0xE2] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // â a circumflex (similar a a)
    [0xE3] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // ã a tilde (similar a a)
    [0xE4] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // ä a diaeresis (similar a a)
    [0xE5] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3A,0x00}, // å a ring (similar a a)
    [0xE6] = {0x00,0x00,0x3C,0x66,0x66,0x3C,0x00,0x00}, // æ ae (similar a c)
    [0xE7] = {0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00}, // ç c cedilla (igual a c)
    [0xE8] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}, // è e grave (similar a e)
    [0xE9] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}, // é e acute (similar a e)
    [0xEA] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}, // ê e circumflex (similar a e)
    [0xEB] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}, // ë e diaeresis (similar a e)
    [0xEC] = {0x18,0x00,0x38,0x10,0x10,0x10,0x3C,0x00}, // ì i grave (similar a i)
    [0xED] = {0x18,0x00,0x38,0x10,0x10,0x10,0x3C,0x00}, // í i acute (similar a i)
    [0xEE] = {0x18,0x00,0x38,0x10,0x10,0x10,0x3C,0x00}, // î i circumflex (similar a i)
    [0xEF] = {0x18,0x00,0x38,0x10,0x10,0x10,0x3C,0x00}, // ï i diaeresis (similar a i)
    [0xF0] = {0x00,0x00,0x7C,0x66,0x66,0x7C,0x60,0x00}, // ð eth (similar a d)
    [0xF1] = {0x00,0x00,0x6E,0x7E,0x7E,0x66,0x66,0x00}, // ñ n tilde (similar a n)
    [0xF2] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // ò o grave (similar a o)
    [0xF3] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // ó o acute (similar a o)
    [0xF4] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // ô o circumflex (similar a o)
    [0xF5] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // õ o tilde (similar a o)
    [0xF6] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // ö o diaeresis (similar a o)
    [0xF7] = {0x00,0x00,0x18,0x7E,0x18,0x00,0x00,0x00}, // ÷ DIVISION SIGN (igual a multiplicação)
    [0xF8] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // ø o stroke (similar a o)
    [0xF9] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00}, // ù u grave (similar a u)
    [0xFA] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00}, // ú u acute (similar a u)
    [0xFB] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00}, // û u circumflex (similar a u)
    [0xFC] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00}, // ü u diaeresis (similar a u)
    [0xFD] = {0x00,0x00,0x66,0x66,0x3C,0x18,0x18,0x00}, // ý y acute (similar a y)
    [0xFE] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // þ thorn (similar a espaco)
    [0xFF] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}  // ÿ y diaeresis (similar a espaco)
};


// Função interna para enviar um comando I2C
static void ssd1306_send_command(uint8_t command) {
    uint8_t buffer[2] = {0x80, command}; // 0x80 = Co = 1, D/C# = 0 (command)
    i2c_write_blocking(i2c1, SSD1306_I2C_ADDR, buffer, 2, false);
}

// Inicializa o display SSD1306
void ssd1306_init(void) {
    // Configura I2C
    i2c_init(i2c1, 400 * 1000); // 400 kHz
    gpio_set_function(I2C_SDA_PIN, GPIO_FUNC_I2C);
    gpio_set_function(I2C_SCL_PIN, GPIO_FUNC_I2C);
    gpio_pull_up(I2C_SDA_PIN);
    gpio_pull_up(I2C_SCL_PIN);

    // Sequência de inicialização do SSD1306
    ssd1306_send_command(SSD1306_SET_DISPLAY | 0x00);         // 0xAE Set Display ON/OFF (0x00 = OFF)
    ssd1306_send_command(SSD1306_SET_DISPLAY_CLOCK_DIVIDE);   // 0xD5 Set Display Clock Divide Ratio/Oscillator Frequency
    ssd1306_send_command(0x80);                               // Default
    ssd1306_send_command(SSD1306_SET_MUX_RATIO);              // 0xA8 Set Multiplex Ratio
    ssd1306_send_command(SSD1306_HEIGHT - 1);                 // 63 para 64 pixels de altura
    ssd1306_send_command(SSD1306_SET_DISPLAY_OFFSET);         // 0xD3 Set Display Offset
    ssd1306_send_command(0x00);                               // No offset
    ssd1306_send_command(SSD1306_SET_DISPLAY_START_LINE | 0x00); // 0x40 Set Display Start Line (0x40 - 0x7F)
    ssd1306_send_command(SSD1306_SET_CHARGE_PUMP);            // 0x8D Charge Pump Setting
    ssd1306_send_command(0x14);                               // Enable Charge Pump
    ssd1306_send_command(SSD1306_SET_MEMORY_MODE);            // 0x20 Set Memory Addressing Mode
    ssd1306_send_command(0x00);                               // 00b = Horizontal Addressing Mode
    ssd1306_send_command(SSD1306_SET_SEGMENT_REMAP | 0x01);   // 0xA0 Set Segment Re-map (0xA0/0xA1)
    ssd1306_send_command(SSD1306_SET_COM_OUTPUT_DIRECTION | 0x08); // 0xC0 Set COM Output Scan Direction (0xC0/0xC8)
    ssd1306_send_command(SSD1306_SET_COM_PIN_CONFIG);         // 0xDA Set COM Pins Hardware Configuration
    #if ((SSD1306_WIDTH == 128) && (SSD1306_HEIGHT == 32))
        ssd1306_send_command(0x02); // 0x02 for 128x32
    #elif ((SSD1306_WIDTH == 128) && (SSD1306_HEIGHT == 64))
        ssd1306_send_command(0x12); // 0x12 for 128x64
    #else
        ssd1306_send_command(0x02); // Default
    #endif
    ssd1306_send_command(SSD1306_SET_CONTRAST);               // 0x81 Set Contrast Control
    ssd1306_send_command(0xFF);                               // Max contrast
    ssd1306_send_command(SSD1306_SET_PRECHARGE);              // 0xD9 Set Pre-charge Period
    ssd1306_send_command(0xF1);                               // Default values
    ssd1306_send_command(SSD1306_SET_VCOMH_DESELECT_LEVEL);   // 0xDB Set VCOMH Deselect Level
    ssd1306_send_command(0x30);                               // 0.77 * VCC
    ssd1306_send_command(SSD1306_SET_ENTIRE_ON);              // 0xA4 Set Entire Display ON/OFF (Resume to RAM content)
    ssd1306_send_command(SSD1306_SET_NORMAL_DISPLAY);         // 0xA6 Set Normal/Inverse Display
    ssd1306_send_command(SSD1306_DEACTIVATE_SCROLL);          // 0x2E Deactivate Scroll
    ssd1306_send_command(SSD1306_SET_DISPLAY | 0x01);         // 0xAF Set Display ON/OFF (0x01 = ON)

    ssd1306_clear(); // Limpa o framebuffer
    ssd1306_update_display(); // Envia o framebuffer limpo para o display
}

// Limpa o framebuffer
void ssd1306_clear(void) {
    memset(ssd1306_framebuffer, 0, SSD1306_BUFFER_SIZE);
}

// Desenha um pixel no framebuffer
void ssd1306_draw_pixel(int16_t x, int16_t y, SSD1306_COLOR color) {
    if (x < 0 || x >= SSD1306_WIDTH || y < 0 || y >= SSD1306_HEIGHT) {
        return; // Fora dos limites
    }

    // Calcula o byte e o bit dentro do byte
    // SSD1306 tem 8 páginas (0-7) para 64 pixels de altura.
    // Cada página contém 8 linhas de pixels.
    // A cada byte (coluna), os bits de 0 a 7 representam os pixels da linha 0 a 7 daquela coluna.
    uint16_t byte_index = x + (y / 8) * SSD1306_WIDTH;
    uint8_t bit_position = y % 8; // Posição do bit dentro do byte (0-7)

    if (color == WHITE) {
        ssd1306_framebuffer[byte_index] |= (1 << bit_position);
    } else { // BLACK
        ssd1306_framebuffer[byte_index] &= ~(1 << bit_position);
    }
}

// Algoritmo de Bresenham para desenhar uma linha
void ssd1306_draw_line(int16_t x0, int16_t y0, int16_t x1, int16_t y1, SSD1306_COLOR color) {
    int16_t dx = abs(x1 - x0);
    int16_t sx = x0 < x1 ? 1 : -1;
    int16_t dy = -abs(y1 - y0);
    int16_t sy = y0 < y1 ? 1 : -1;
    int16_t err = dx + dy;
    int16_t e2;

    while (true) {
        ssd1306_draw_pixel(x0, y0, color);
        if (x0 == x1 && y0 == y1) break;
        e2 = 2 * err;
        if (e2 >= dy) {
            err += dy;
            x0 += sx;
        }
        if (e2 <= dx) {
            err += dx;
            y0 += sy;
        }
    }
}

// Desenha um caractere no framebuffer (8x8 pixels)
void ssd1306_draw_char(int16_t x, int16_t y, char character, SSD1306_COLOR color) {
    // Agora aceitamos todo o range de 0-255. Mapeamos os caracteres de controle para ' '.
    if ((uint8_t)character < 0x20) { // Caracteres de controle ASCII
        character = ' ';
    }

    // Acessa diretamente o bitmap da fonte
    // O cast para uint8_t garante que o indice esteja no range 0-255
    const uint8_t *char_bitmap = font8x8_basic[(uint8_t)character];

    for (uint8_t col = 0; col < 8; col++) {
        uint8_t byte_data = char_bitmap[col]; // Obtenha a coluna de pixels do caractere

        // Desenha cada pixel da coluna
        for (uint8_t row = 0; row < 8; row++) {
            if ((byte_data >> row) & 0x01) { // Se o bit está ligado na fonte
                ssd1306_draw_pixel(x + col, y + row, color);
            } else if (color == BLACK) {
                // Se o bit está desligado na fonte, mas a cor é BLACK,
                // significa que queremos garantir que esse pixel esteja OFF.
                ssd1306_draw_pixel(x + col, y + row, BLACK);
            }
        }
    }
}

// Desenha uma string
void ssd1306_draw_string(int16_t x, int16_t y, const char *string, SSD1306_COLOR color) {
    while (*string) {
        // Verificar se há espaço suficiente para o próximo caractere
        if (x + 8 > SSD1306_WIDTH) {
            break; // Sai se não houver mais espaço na linha
        }
        ssd1306_draw_char(x, y, *string, color);
        x += 8; // Avança 8 pixels para o próximo caractere
        string++;
    }
}

// Envia o framebuffer para o display
void ssd1306_update_display(void) {
    // Configura o endereçamento de coluna e página para cobrir todo o display
    ssd1306_send_command(SSD1306_SET_COLUMN_ADDRESS);
    ssd1306_send_command(0x00);                       // Start Column Address 0
    ssd1306_send_command(SSD1306_WIDTH - 1);          // End Column Address 127
    ssd1306_send_command(SSD1306_SET_PAGE_ADDRESS);
    ssd1306_send_command(0x00);                       // Start Page Address 0
    ssd1306_send_command((SSD1306_HEIGHT / 8) - 1);   // End Page Address 7 (para 64 de altura)

    // Envia os dados do framebuffer (com byte de controle 0x40 para dados)
    uint8_t *temp_buffer = malloc(SSD1306_BUFFER_SIZE + 1);
    if (temp_buffer == NULL) {
        // Lidar com erro de alocação de memória, se necessário
        // (Ex: printf("Erro: Falha na alocação de memória para o buffer de atualização do display.\n");)
        return;
    }
    temp_buffer[0] = 0x40; // Co = 0, D/C# = 1 (data)
    memcpy(temp_buffer + 1, ssd1306_framebuffer, SSD1306_BUFFER_SIZE);

    i2c_write_blocking(i2c1, SSD1306_I2C_ADDR, temp_buffer, SSD1306_BUFFER_SIZE + 1, false);

    free(temp_buffer);
}